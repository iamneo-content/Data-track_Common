-- =====================================================================
-- COMPARE DISTRIBUTION STYLES (KEY, EVEN, ALL)
-- =====================================================================

-- STEP 0: Clean up existing tables (safe re-run)
DROP TABLE IF EXISTS sales_key;
DROP TABLE IF EXISTS sales_even;
DROP TABLE IF EXISTS sales_all;

-- STEP 1: Create Tables with Different Distribution Styles

CREATE TABLE sales_key (
    sale_id INT,
    product_id INT,
    customer_id INT,
    sale_date DATE,
    quantity INT,
    price DECIMAL(10,2)
)
DISTSTYLE KEY
DISTKEY (product_id);

CREATE TABLE sales_even (
    sale_id INT,
    product_id INT,
    customer_id INT,
    sale_date DATE,
    quantity INT,
    price DECIMAL(10,2)
)
DISTSTYLE EVEN;

CREATE TABLE sales_all (
    sale_id INT,
    product_id INT,
    customer_id INT,
    sale_date DATE,
    quantity INT,
    price DECIMAL(10,2)
)
DISTSTYLE ALL;


INSERT INTO sales_key VALUES
(1, 101, 5001, '2025-10-01', 2, 999.99),
(2, 102, 5002, '2025-10-02', 1, 499.99),
(3, 103, 5003, '2025-10-03', 3, 150.00),
(4, 104, 5004, '2025-10-04', 5, 200.00),
(5, 105, 5005, '2025-10-05', 1, 799.00),
(6, 106, 5006, '2025-10-06', 2, 249.99),
(7, 107, 5007, '2025-10-07', 1, 499.00),
(8, 108, 5008, '2025-10-08', 4, 129.50),
(9, 109, 5009, '2025-10-09', 6, 89.99),
(10, 110, 5010, '2025-10-10', 1, 999.00),
(11, 111, 5011, '2025-10-11', 2, 349.00),
(12, 112, 5012, '2025-10-12', 1, 699.99),
(13, 113, 5013, '2025-10-13', 3, 449.50),
(14, 114, 5014, '2025-10-14', 5, 119.99),
(15, 115, 5015, '2025-10-15', 2, 189.99),
(16, 116, 5016, '2025-10-16', 1, 599.99),
(17, 117, 5017, '2025-10-17', 3, 329.00),
(18, 118, 5018, '2025-10-18', 4, 259.50),
(19, 119, 5019, '2025-10-19', 1, 849.99),
(20, 120, 5020, '2025-10-20', 5, 159.00),
(21, 121, 5021, '2025-10-21', 2, 179.99),
(22, 122, 5022, '2025-10-22', 1, 499.00),
(23, 123, 5023, '2025-10-23', 4, 299.99),
(24, 124, 5024, '2025-10-24', 3, 209.00),
(25, 125, 5025, '2025-10-25', 2, 749.50),
(26, 126, 5026, '2025-10-26', 1, 229.00),
(27, 127, 5027, '2025-10-27', 3, 399.99),
(28, 128, 5028, '2025-10-28', 2, 159.00),
(29, 129, 5029, '2025-10-29', 4, 599.00),
(30, 130, 5030, '2025-10-30', 2, 799.00);

INSERT INTO sales_even VALUES
(31, 201, 5101, '2025-10-01', 3, 349.99),
(32, 202, 5102, '2025-10-02', 1, 649.99),
(33, 203, 5103, '2025-10-03', 2, 899.00),
(34, 204, 5104, '2025-10-04', 4, 229.50),
(35, 205, 5105, '2025-10-05', 5, 119.00),
(36, 206, 5106, '2025-10-06', 1, 329.00),
(37, 207, 5107, '2025-10-07', 2, 189.99),
(38, 208, 5108, '2025-10-08', 6, 249.00),
(39, 209, 5109, '2025-10-09', 1, 179.00),
(40, 210, 5110, '2025-10-10', 4, 429.99),
(41, 211, 5111, '2025-10-11', 2, 519.00),
(42, 212, 5112, '2025-10-12', 3, 749.50),
(43, 213, 5113, '2025-10-13', 1, 299.99),
(44, 214, 5114, '2025-10-14', 5, 209.99),
(45, 215, 5115, '2025-10-15', 2, 699.00),
(46, 216, 5116, '2025-10-16', 3, 549.00),
(47, 217, 5117, '2025-10-17', 4, 189.00),
(48, 218, 5118, '2025-10-18', 5, 259.99),
(49, 219, 5119, '2025-10-19', 2, 479.99),
(50, 220, 5120, '2025-10-20', 3, 129.00),
(51, 221, 5121, '2025-10-21', 2, 799.00),
(52, 222, 5122, '2025-10-22', 1, 899.99),
(53, 223, 5123, '2025-10-23', 3, 119.00),
(54, 224, 5124, '2025-10-24', 5, 429.00),
(55, 225, 5125, '2025-10-25', 4, 259.00),
(56, 226, 5126, '2025-10-26', 2, 159.99),
(57, 227, 5127, '2025-10-27', 3, 599.00),
(58, 228, 5128, '2025-10-28', 2, 339.00),
(59, 229, 5129, '2025-10-29', 4, 749.99),
(60, 230, 5130, '2025-10-30', 1, 199.00);

INSERT INTO sales_all VALUES
(61, 301, 5201, '2025-10-01', 2, 399.99),
(62, 302, 5202, '2025-10-02', 1, 599.00),
(63, 303, 5203, '2025-10-03', 3, 899.00),
(64, 304, 5204, '2025-10-04', 5, 299.99),
(65, 305, 5205, '2025-10-05', 1, 799.99),
(66, 306, 5206, '2025-10-06', 2, 179.00),
(67, 307, 5207, '2025-10-07', 4, 229.00),
(68, 308, 5208, '2025-10-08', 3, 349.00),
(69, 309, 5209, '2025-10-09', 5, 459.00),
(70, 310, 5210, '2025-10-10', 1, 549.99),
(71, 311, 5211, '2025-10-11', 2, 649.00),
(72, 312, 5212, '2025-10-12', 3, 749.00),
(73, 313, 5213, '2025-10-13', 4, 849.00),
(74, 314, 5214, '2025-10-14', 5, 949.00),
(75, 315, 5215, '2025-10-15', 2, 159.00),
(76, 316, 5216, '2025-10-16', 3, 259.00),
(77, 317, 5217, '2025-10-17', 1, 359.00),
(78, 318, 5218, '2025-10-18', 4, 459.00),
(79, 319, 5219, '2025-10-19', 2, 559.00),
(80, 320, 5220, '2025-10-20', 3, 659.00),
(81, 321, 5221, '2025-10-21', 4, 759.00),
(82, 322, 5222, '2025-10-22', 5, 859.00),
(83, 323, 5223, '2025-10-23', 2, 959.00),
(84, 324, 5224, '2025-10-24', 3, 1059.00),
(85, 325, 5225, '2025-10-25', 1, 1159.00),
(86, 326, 5226, '2025-10-26', 2, 1259.00),
(87, 327, 5227, '2025-10-27', 3, 1359.00),
(88, 328, 5228, '2025-10-28', 4, 1459.00),
(89, 329, 5229, '2025-10-29', 5, 1559.00),
(90, 330, 5230, '2025-10-30', 1, 1659.00);

SELECT * 
FROM svv_tables 
WHERE table_name ILIKE 'sales_%';

SELECT
    table_id,
    "table" AS table_name,
    diststyle,
    skew_rows
FROM svv_table_info
WHERE "table" LIKE 'sales_%'
ORDER BY "table";

SELECT 'sales_key' AS table_name, COUNT(*) AS row_count FROM sales_key
UNION ALL
SELECT 'sales_even', COUNT(*) FROM sales_even
UNION ALL
SELECT 'sales_all', COUNT(*) FROM sales_all;

-- -- =====================================================================
-- -- END OF SCRIPT
-- -- =====================================================================

